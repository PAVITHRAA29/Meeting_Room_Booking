{"ast":null,"code":"import axios from \"axios\";\nimport { store } from \"../../store/store\";\nimport { api } from \"../../constant/apiConstant\";\nimport { cleanData, updateToken } from \"../../store/userSlice\";\nconst apifunction = async obj => {\n  const {\n    accessToken,\n    refreshToken\n  } = store.getState().userReducer.data;\n  if (obj.auth) {\n    const temp = obj;\n    const config = {\n      url: obj.url,\n      method: obj.method,\n      data: obj.payload,\n      headers: {\n        Authorization: `Bearer ${accessToken}`\n      }\n    };\n    try {\n      const authResponse = await axios(config);\n      return authResponse;\n    } catch (error) {\n      if (error.response) {\n        if (error.response.status === 403) {\n          try {\n            const refreshtoken = await axios({\n              url: api.baseurl + api.refreshToken,\n              method: \"get\",\n              headers: {\n                Authorization: `Bearer ${refreshToken}`\n              }\n            });\n            const data = refreshtoken.data;\n            await store.dispatch(updateToken(data.data));\n            const {\n              accessToken\n            } = store.getState().userReducer.data;\n            const newconfig = {\n              url: temp.url,\n              method: temp.method,\n              data: temp.payload,\n              headers: {\n                Authorization: `Bearer ${accessToken}`\n              }\n            };\n            const authResponse = await axios(newconfig);\n            return authResponse;\n          } catch (err) {\n            store.dispatch(cleanData());\n            return {\n              status: 403,\n              statusText: \"token expire\"\n            };\n          }\n        } else {\n          return {\n            status: error.response.status,\n            data: error.response.data\n          };\n        }\n      }\n      if (error.request) {\n        return {\n          status: 500,\n          statusText: \"request error\"\n        };\n      }\n    }\n  } else {\n    const config = {\n      url: obj.url,\n      method: obj.method,\n      data: obj.payload\n    };\n    try {\n      //success api call\n      const response = await axios(config);\n      return response;\n    } catch (error) {\n      //error based on 401\n      if (error.response) {\n        return {\n          status: error.response.status,\n          data: error.response.data\n        };\n      } else if (error.request) {\n        return {\n          //bad request\n          status: 500,\n          statusText: \"Network error occurred\"\n        };\n      } else {\n        return {\n          //unexecpted error\n          status: 501,\n          statusText: \"An unexpected error occurred\"\n        };\n      }\n    }\n  }\n};\nexport default apifunction;","map":{"version":3,"names":["axios","store","api","cleanData","updateToken","apifunction","obj","accessToken","refreshToken","getState","userReducer","data","auth","temp","config","url","method","payload","headers","Authorization","authResponse","error","response","status","refreshtoken","baseurl","dispatch","newconfig","err","statusText","request"],"sources":["/home/divum/Desktop/Meetingroom/development git/room-finder-frontend/src/utils/apiCall/index.tsx"],"sourcesContent":["import axios, { AxiosRequestConfig, AxiosResponse } from \"axios\";\nimport { Apitype, ErrorResponse, Response, Tokenentity } from \"../../type\";\nimport { store } from \"../../store/store\";\nimport { api } from \"../../constant/apiConstant\";\nimport { cleanData, updateToken } from \"../../store/userSlice\";\n\nconst apifunction = async (\n  obj: Apitype\n): Promise<AxiosResponse<Response> | ErrorResponse | any> => {\n  const { accessToken, refreshToken } = store.getState().userReducer.data;\n\n  if (obj.auth) {\n    const temp = obj;\n\n    const config: AxiosRequestConfig = {\n      url: obj.url,\n      method: obj.method,\n      data: obj.payload,\n      headers: {\n        Authorization: `Bearer ${accessToken}`,\n      },\n    };\n\n    try {\n      const authResponse = await axios(config);\n\n      return authResponse;\n    } catch (error: any) {\n      if (error.response) {\n        if (error.response.status === 403) {\n          try {\n            const refreshtoken = await axios({\n              url: api.baseurl + api.refreshToken,\n              method: \"get\",\n              headers: { Authorization: `Bearer ${refreshToken}` },\n            });\n            const data = refreshtoken.data as Response;\n            await store.dispatch(updateToken(data.data as any as Tokenentity));\n            const { accessToken } = store.getState().userReducer.data;\n            const newconfig: AxiosRequestConfig = {\n              url: temp.url,\n              method: temp.method,\n              data: temp.payload,\n              headers: {\n                Authorization: `Bearer ${accessToken}`,\n              },\n            };\n\n            const authResponse = await axios(newconfig);\n\n            return authResponse;\n          } catch (err) {\n            store.dispatch(cleanData());\n            return { status: 403, statusText: \"token expire\" };\n          }\n        } else {\n          return {\n            status: error.response.status as number,\n            data: error.response.data as any,\n          };\n        }\n      }\n      if (error.request) {\n        return { status: 500, statusText: \"request error\" };\n      }\n    }\n  } else {\n    const config: AxiosRequestConfig = {\n      url: obj.url,\n      method: obj.method,\n      data: obj.payload,\n    };\n\n    try {\n      //success api call\n      const response = await axios(config);\n\n      return response;\n    } catch (error: any) {\n      //error based on 401\n      if (error.response) {\n        return {\n          status: error.response.status as number,\n          data: error.response.data as any,\n        };\n      } else if (error.request) {\n        return {\n          //bad request\n          status: 500,\n          statusText: \"Network error occurred\",\n        };\n      } else {\n        return {\n          //unexecpted error\n          status: 501,\n          statusText: \"An unexpected error occurred\",\n        };\n      }\n    }\n  }\n};\n\nexport default apifunction;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}